<div class="app-container">
  <app-sidebar></app-sidebar>
  
  <!-- Main Content -->
  <div class="main-content">
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-content">
        <h1>Goals</h1>
        <p>{{ today | date:'EEEE, MMMM d, y' }}</p>
      </div>
      <div class="search-container">
        <input type="text" placeholder="Search for goals...">
        <button class="search-button"><i class="fas fa-search"></i></button>
      </div>
      <div class="user-menu">
        <div class="notifications">
          <i class="fas fa-bell"></i>
          <span class="badge">3</span>
        </div>
        <div class="messages">
          <i class="fas fa-envelope"></i>
          <span class="badge">2</span>
        </div>
        <div class="user-profile-mini">
          <img src="assets/images/user.png" alt="User">
          <span>{{ userName }}</span>
          <i class="fas fa-chevron-down"></i>
        </div>
      </div>
    </div>

    <!-- Goals Content -->
    <div class="goals-container">
      <!-- Loading and Error States -->
      <div *ngIf="isLoading" class="loading-container">
        <div class="spinner"></div>
        <p>Loading your goals...</p>
      </div>

      <div *ngIf="error && !isLoading" class="error-message">
        <p>{{ error }}</p>
        <button (click)="loadGoals()">Try Again</button>
      </div>

      <!-- Goals Content when loaded -->
      <div *ngIf="!isLoading && !error">
        <!-- Goals Summary and Add Button -->
        <div class="goals-header">
          <div class="goals-summary">
            <h2>Your Goals Journey</h2>
            <p>Track your progress and achieve your mental wellness targets</p>
          </div>
          <button class="add-goal-btn" (click)="toggleAddGoalForm()">
            <i class="fas fa-plus"></i> Add New Goal
          </button>
        </div>

        <!-- Goal Categories -->
        <div class="goal-categories">
          <div class="category-pills">
            <button 
              class="category-pill" 
              [ngClass]="{'active': selectedCategory === 'All'}" 
              (click)="filterByCategory('All')"
            >
              All
            </button>
            <button 
              *ngFor="let category of categories" 
              class="category-pill" 
              [ngClass]="{'active': selectedCategory === category}"
              (click)="filterByCategory(category)"
            >
              {{category}}
            </button>
          </div>
        </div>

        <!-- Add Goal Form (Hidden by default) -->
        <div class="add-goal-form" *ngIf="showAddGoalForm">
          <h3>Create New Goal</h3>
          <div class="form-group">
            <label for="goal-title">Title</label>
            <input type="text" id="goal-title" [(ngModel)]="newGoal.goalTitle" placeholder="Enter goal title">
          </div>
          <div class="form-group">
            <label for="goal-description">Description</label>
            <textarea id="goal-description" [(ngModel)]="newGoal.goalDescription" placeholder="Describe your goal"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group half">
              <label for="goal-category">Category</label>
              <select id="goal-category" [(ngModel)]="newGoal.category">
                <option *ngFor="let category of categories" [value]="category">{{category}}</option>
              </select>
            </div>
            <div class="form-group half">
              <label for="goal-type">Goal Type</label>
              <select id="goal-type" [(ngModel)]="newGoal.goalType">
                <option *ngFor="let type of goalTypes" [value]="type">{{type}}</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="goal-due-date">Due Date</label>
            <input type="date" id="goal-due-date" [(ngModel)]="newGoal.dueDate">
          </div>
          <div class="form-actions">
            <button class="cancel-btn" (click)="toggleAddGoalForm()">Cancel</button>
            <button class="save-btn" (click)="saveNewGoal()">Save Goal</button>
          </div>
        </div>

        <!-- Goals List -->
        <div class="goals-list">
          <div class="goal-card" *ngFor="let goal of getFilteredGoals()">
            <div class="goal-header">
              <div class="goal-title-area">
                <h3>{{goal.goal_title}}</h3>
                <span class="priority-badge" [ngClass]="'priority-' + (goal.goal_type === 'Daily' ? 'high' : (goal.goal_type === 'Weekly' ? 'medium' : 'low'))">
                  {{goal.goal_type}}
                </span>
              </div>
              <div class="goal-actions">
                <button class="edit-btn"><i class="fas fa-edit"></i></button>
                <button class="delete-btn" (click)="deleteGoal(goal.id!)"><i class="fas fa-trash"></i></button>
              </div>
            </div>
            
            <div class="goal-body">
              <p class="goal-description">{{goal.goal_description || 'No description provided.'}}</p>
              <div class="goal-meta">
                <span class="goal-category">{{goal['category']}}</span>
                <span class="goal-due-date">Due: {{formatDate(goal.due_date)}}</span>
              </div>
              <div class="goal-progress">
                <div class="progress-label">
                  <span>Progress: {{goal.progress_percentage}}%</span>
                  <span *ngIf="goal.is_completed" class="completed-badge">Completed</span>
                </div>
                <div class="progress-bar-container">
                  <div class="progress-bar" [style.width.%]="goal.progress_percentage"></div>
                </div>
              </div>
              <div class="progress-controls">
                <button class="progress-btn" (click)="updateGoalProgress(goal, goal.progress_percentage - 10)" [disabled]="goal.progress_percentage <= 0">-</button>
                <input type="range" min="0" max="100" step="10" [(ngModel)]="goal.progress_percentage" (change)="updateGoalProgress(goal, goal.progress_percentage)">
                <button class="progress-btn" (click)="updateGoalProgress(goal, goal.progress_percentage + 10)" [disabled]="goal.progress_percentage >= 100">+</button>
              </div>
            </div>
          </div>

          <!-- Empty state when no goals match filter -->
          <div class="empty-state" *ngIf="getFilteredGoals().length === 0">
            <img src="assets/images/empty-goals.svg" alt="No goals found">
            <h3>No goals found</h3>
            <p>You don't have any goals in this category yet. Click the "Add New Goal" button to create one.</p>
          </div>
        </div>
        
        <!-- Goals Stats -->
        <div class="goals-stats">
          <div class="stats-card">
            <div class="stat-value">{{getTotalGoalsCount()}}</div>
            <div class="stat-label">Total Goals</div>
          </div>
          <div class="stats-card">
            <div class="stat-value">{{getCompletedGoalsCount()}}</div>
            <div class="stat-label">Completed</div>
          </div>
          <div class="stats-card">
            <div class="stat-value">{{getOverdueGoalsCount()}}</div>
            <div class="stat-label">Overdue</div>
          </div>
          <div class="stats-card">
            <div class="stat-value">{{getHighPriorityGoalsCount()}}</div>
            <div class="stat-label">High Priority</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>