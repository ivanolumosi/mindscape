<div class="main-container" [ngClass]="{'sidebar-visible': sidebarVisible}">
  <app-sidebar></app-sidebar>
  <!-- Main Feed Section -->
  <div class="feed-container">
    <div class="post-creator card">
      <div class="creator-header">
        <h3>Share Something</h3>
      </div>
      <div class="creator-content">
        <form [formGroup]="postForm" (ngSubmit)="onSubmit()">
          <textarea 
            formControlName="content" 
            placeholder="What's on your mind?" 
            rows="3"
            [class.error]="postForm.get('content')?.invalid && postForm.get('content')?.touched">
          </textarea>
          
          <div *ngIf="imagePreview" class="preview-container">
            <div class="image-preview">
              <img [src]="imagePreview" alt="Image Preview" />
              <button type="button" class="remove-image" (click)="removeImage()">√ó</button>
            </div>
          </div>
          
          <div class="post-actions">
            <div class="media-options">
              <label class="custom-file-upload">
                <input #fileInput type="file" accept="image/*" (change)="onFileSelected($event)">
                <i class="fas fa-image"></i> Add Image
              </label>
            </div>
            
            <button 
              type="submit" 
              class="btn btn-primary" 
              [disabled]="isSubmitting || (!postForm.get('content')?.value && !imagePreview)">
              {{ isSubmitting ? 'Posting...' : 'Post' }}
            </button>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Filter Options -->
    <div class="filter-options mb-3">
      <button 
        class="btn btn-outline" 
        [class.active]="includeCounselors" 
        (click)="toggleCounselorPosts()">
        {{ includeCounselors ? 'Include Counselor Posts' : 'Hide Counselor Posts' }}
      </button>
    </div>
    
    <!-- Posts Feed -->
    <div *ngIf="loadingPosts && posts.length === 0" class="loading-spinner">
      <div class="spinner"></div>
      <p>Loading posts...</p>
    </div>
    
    <div *ngIf="!loadingPosts && posts.length === 0" class="no-posts">
      <img src="assets/images/empty-feed.svg" alt="No Posts">
      <h3>No posts yet</h3>
      <p>Be the first to share something with the community!</p>
    </div>
    
    <div *ngFor="let post of posts" class="post-card fade-in">
      <div class="post-header">
        <div class="user-info">
          <img 
            [src]="post.profile_image || 'assets/images/avatar1.png'" 
            [class.counselor-avatar]="post.is_counselor" 
            class="avatar" 
            alt="User Avatar">
          <div class="user-details">
            <h4>
              {{ post.user_name }}
              <span *ngIf="post.nickname" class="nickname">({{ post.nickname }})</span>
              <span *ngIf="post.is_counselor" class="counselor-badge">üë®‚Äç‚öïÔ∏è Counselor</span>
            </h4>
            <p class="post-time">{{ post.formatCreationTime() }}</p>
          </div>
        </div>
<div class="post-actions" *ngIf="post.user_id === authService.getCurrentUserId()">
  <button class="action-btn" (click)="togglePostOptions(post)">
    <i class="fas fa-ellipsis-v"></i>
  </button>
  
  <div *ngIf="post.showOptions" class="options-menu">
    <button (click)="deletePost(post)">Delete</button>
  </div>
</div>
</div>

<div class="post-content">
<p *ngIf="post.hasText()">{{ post.content }}</p>

<div *ngIf="post.hasMedia()" class="media-content">
  <img [src]="post.media_url" alt="Post Image" class="post-image">
</div>
</div>

<div class="post-footer">
<div class="interaction-buttons">
  <button class="btn-icon" (click)="toggleLike(post)">
    <i [class]="post.liked ? 'fas fa-heart liked' : 'far fa-heart'"></i>
    <span *ngIf="post.likes > 0" class="interaction-count">{{ post.likes }}</span>
  </button>
  
  <button class="btn-icon" (click)="toggleComments(post)">
    <i class="far fa-comment"></i>
    <span *ngIf="post.comment_count > 0" class="interaction-count">{{ post.comment_count }}</span>
  </button>
  
  <button class="btn-icon" (click)="toggleSave(post)">
    <i [class]="post.saved ? 'fas fa-bookmark saved' : 'far fa-bookmark'"></i>
  </button>
</div>
</div>

<!-- Comments Section -->
<div *ngIf="post.showComments" class="comments-section">
<div *ngIf="post.loadingComments" class="loading-spinner">
  <div class="spinner small"></div>
</div>

<div *ngIf="!post.loadingComments && post.comments.length === 0" class="no-comments">
  <p>No comments yet. Be the first to comment!</p>
</div>

<div *ngIf="!post.loadingComments && post.comments.length > 0" class="comments-list">
  <div *ngFor="let comment of post.comments" class="comment">
    <img 
      [src]="comment.profile_image || 'assets/images/avatar1.png'" 
      class="comment-avatar" 
      alt="User Avatar">
    
    <div class="comment-content">
      <div class="comment-header">
        <h5>
          {{ comment.user_name }}
          <span *ngIf="comment.nickname" class="nickname">({{ comment.nickname }})</span>
        </h5>
        <span class="comment-time">
          {{ formatCommentTime(comment.created_at) }}
        </span>
      </div>
      
      <p>{{ comment.content }}</p>
      
      <div *ngIf="comment.media_url" class="comment-media">
        <img [src]="comment.media_url" alt="Comment Image">
      </div>
      
      <div *ngIf="comment.user_id === authService.getCurrentUserId()" class="comment-options">
        <button class="btn-text" (click)="deleteComment(post, comment.id)">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Comment Form -->
<div class="add-comment">
  <img 
    [src]="authService.getCurrentUser()?.profileImage || 'assets/images/avatar1.png'" 
    class="comment-avatar" 
    alt="Your Avatar">
  
  <div class="comment-input">
    <textarea 
      [(ngModel)]="post.newComment" 
      placeholder="Write a comment..." 
      rows="1"
      (keydown.enter)="$event.preventDefault(); addComment(post);">
    </textarea>
    
    <div *ngIf="post.commentPreview" class="comment-preview">
      <img [src]="post.commentPreview" alt="Comment Image Preview">
      <button type="button" class="remove-preview" (click)="removeCommentImage(post)">√ó</button>
    </div>
    
    <div class="comment-actions">
      <label class="file-upload-icon">
        <input #commentFileInput type="file" accept="image/*" (change)="onCommentFileSelected($event, post)">
        <i class="far fa-image"></i>
      </label>
      
      <!-- Send Button for Comments -->
      <button 
        type="button" 
        class="send-comment" 
        [disabled]="!post.newComment.trim() && !post.commentFile"
        (click)="addComment(post)">
        <i class="far fa-paper-plane"></i>
      </button>
    </div>
  </div>
</div>
</div>
</div>

<!-- Load More / End of Feed -->
<div *ngIf="posts.length > 0" class="load-more">
<button 
*ngIf="!noMorePosts" 
class="btn btn-outline" 
[class.loading]="loadingPosts" 
(click)="loadMorePosts()" 
[disabled]="loadingPosts">
{{ loadingPosts ? 'Loading...' : 'Load More' }}
</button>

<p *ngIf="noMorePosts" class="end-of-feed">You've reached the end of your feed</p>
</div>
</div>
</div>